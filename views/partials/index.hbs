<script>

	$(document).ready(function () {
		console.log('is ready');

		$('#chkShowAllQueue').change(function () {
			console.log('change enabled state');
			if ($(this).is(":checked")) {
				$('#selectQueue').prop("disabled", "disabled");
				$('#chkShowQueueName').prop("disabled", "disabled");
			} else {
				$('#selectQueue').prop("disabled", "");
				$('#chkShowQueueName').prop("disabled", "");
			}
		});

		$('#btnShow').click(function (e) {
			buildData();
		});

		$('#btnGenerate').click(function (e) {
			buildData();
		});

		$('.dropdown-item').click(function (e) {
			$("#btnSelectRegion").html(e.target.innerText);
			onFormChange(e);
		});

		function buildData() {
			var data = {
				fullString: $('#chkShowFullString').is(":checked"),
				showAllQueue: $('#chkShowAllQueue').is(":checked"),
				showQueue: $('#chkShowQueueName').is(":checked"),
				showLp: $('#chkShowLP').is(":checked"),
				showWR: $('#chkShowWinRate').is(":checked"),
				summonerName: $('#txbSummonerName').val(),
				queue: $('#selectQueue').val(),
				region: $("#btnSelectRegion").html()
			}

			console.dir(data);

			return data;
		}

		function validate(data) {
			var err = [];
			if (data.summonerName == null || data.summonerName.length === 0) {
				err.push('SummonerName is mandatory');
			}
			if (data.region == null || data.region == "Select a region" || data.region.length === 0) {
				err.push('Region is mandatory')
			}

			return err;
		}

		function generateUrl(data) {
			var urls = {
				base: 'https://api.bedyapi.com/lol/rank/',
				nightbot: '$(urlfetch {url})',
				wizebot: '$urlcall({url},1)',
				se: '${urlfetch {url}}',
				sl: '{readapi.{url}}',
				userUrl: '',
				param: ''
			}

			var mandatory = `{region}/{username}`;
			var param = '';

			// ?type=0&fullString=1&lp=0&winrate=0
			var url = urls.base;
			mandatory = mandatory.replace('{region}', data.region).replace('{username}', data.summonerName);
			url += mandatory;

			if (data.fullString === true) {
				if (param.length == 0) { param += "?"; }
				if (param.length > 1) { param += "&"; }
				param += "fullstring=1";
			}
			if (data.showAllQueue === true) {
				if (param.length == 0) { param += "?"; }
				if (param.length > 1) { param += "&"; }
				param += "all=1";
			} else {
				if (data.showQueue === false) {
					if (param.length == 0) { param += "?"; }
					if (param.length > 1) { param += "&"; }
					param += "type=0";
				}
			}

			if (data.showLp === false) {
				if (param.length == 0) { param += "?"; }
				if (param.length > 1) { param += "&"; }
				param += "lp=0";
			}
			if (data.showWR === false) {
				if (param.length == 0) { param += "?"; }
				if (param.length > 1) { param += "&"; }
				param += "winrate=0";
			}

			if (data.showAllQueue === false) {
				if (data.queue == "tft") {
					if (param.length == 0) { param += "?"; }
					if (param.length > 1) { param += "&"; }
					param += `queueType=tft`;

				} else if (data.queue == "flexQ") {
					if (param.length == 0) { param += "?"; }
					if (param.length > 1) { param += "&"; }
					param += `queueType=flex`;
				}
			}


			url += param;

			urls.param = param;
			urls.userUrl = url;

			return urls;
		}

		$('form input').change(function (e) {
			onFormChange(e);
		});
		$('form select').change(function (e) {
			onFormChange(e);
		});

		function onFormChange(e) {
			console.log(e);
			var data = buildData();
			var err = validate(data);
			if (!err || err.length == 0) {
				var returnsUrl = generateUrl(data);

				$("#txbDirectUrl").val(returnsUrl.userUrl);
				$("#txbNightBotUrl").val(returnsUrl.nightbot.replace('{url}', returnsUrl.userUrl));
				$("#txbWizeBotUrl").val(returnsUrl.wizebot.replace('{url}', returnsUrl.userUrl));
				$("#txbStreamElementUrl").val(returnsUrl.se.replace('{url}', returnsUrl.userUrl));
				$("#txbStreamLabsUrl").val(returnsUrl.sl.replace('{url}', returnsUrl.userUrl));
			}
			return false;
		}
	});

</script>
<p>Welcome to Bedy API.

	Enter your summoner name, select a region and a queue.
</p>
<form id="apiForm">
	<!--  class="row g-3" -->
	<div class="container">
		<div class="row g-3 align-items-center">
			<legend>Required</legend>

			<div class="input-group mb-3">
				<button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
					aria-expanded="false" id="btnSelectRegion">Select a region</button>
				<ul class="dropdown-menu" id="selectRegion">
					<li><a class="dropdown-item" id="region_NA" value="NA">NA</a></li>
					<li><a class="dropdown-item" id="EUW" value="EUW">EUW</a></li>
					<li><a class="dropdown-item" id="EUNE" id="EUNW">EUNE</a></li>
				</ul>
				<input type="text" class="form-control" aria-label="Enter your summonername"
					placeholder="Enter your summonerName" id="txbSummonerName">
			</div>

			<div class="col-md-2">
				<label class="form-check-label" for="selectQueue">Queue</label> <br />
				<select class="form-select" aria-label="Select a queue" id="selectQueue">
					<option value="soloQ" selected="true">SoloQ</option>
					<option value="flexQ">FlexQ</option>
					<option value="tft">TFT</option>
				</select>
			</div>


			<legend>Parameters</legend>
			{{!-- <div class="col-md-2">
				<label class="form-check-label" for="selectQueue">Queue</label> <br />
				<select class="form-select" aria-label="Select a queue" id="selectQueue">
					<option value="soloQ" selected="true">SoloQ</option>
					<option value="flexQ">FlexQ</option>
					<option value="tft">TFT</option>
				</select>
			</div> --}}
			{{!-- <div class="col-md-6">
				<!-- all -->
				<input type="checkbox" class="form-check-input" id="chkShowAllQueue">
				<label class="form-check-label" for="chkShowAllQueue">Afficher toutes les queues</label> <br />

				<!-- type -->
				<input type="checkbox" class="form-check-input" id="chkShowWinRate">
				<label class="form-check-label" for="chkShowWinRate">Afficher le nom de la queue</label> <br />
			</div> --}}

			<div class="col-md-4">
				<div class="form-check">
					<div class="mb-6">
						<!-- fullString -->
						<input type="checkbox" class="form-check-input" id="chkShowFullString">
						<label class="form-check-label" for="chkShowFullString" disabled="disabled">Show
							summonerName</label> <br />

						<!-- all -->
						<input type="checkbox" class="form-check-input" id="chkShowAllQueue">
						<label class="form-check-label" for="chkShowAllQueue">Show all Summoner's Rift queues</label>
						<br />

						<!-- type -->
						<input type="checkbox" class="form-check-input" id="chkShowQueueName" checked="checked">
						<label class="form-check-label" for="chkShowQueueName">Show queue
							names</label> <br />

						<!-- lp -->
						<input type="checkbox" class="form-check-input" id="chkShowLP" checked="checked">
						<label class="form-check-label" for="chkShowLP">Show LP</label> <br />

						<!-- winrate -->
						<input type="checkbox" class="form-check-input" id="chkShowWinRate" checked="checked">
						<label class="form-check-label" for="chkShowWinRate">Show WinRate</label>
						<br />
					</div>
				</div>
			</div>
			<div class="col-md-8" id="previewResult">
				{{!-- Hans Sälma est actuellement DIAMOND III (49 LP) - 52.4 % (199W/181L) (SoloQ/DuoQ) / MASTER I (29 LP) -
				58.8 % (57W/40L) (Flex) --}}
			</div>

			<div class="col-md-12" id="generateREsult">
				<label class="visually-hidden" for="txbDirectUrl">Url</label>
				<div class="input-group">
					<div class="input-group-text">Url</div>
					<input type="text" class="form-control" id="txbDirectUrl" placeholder="Url">
				</div>

				<label class="visually-hidden" for="txbNightBotUrl">Nightbot URL</label>
				<div class="input-group">
					<div class="input-group-text">NightBot</div>
					<input type="text" class="form-control" id="txbNightBotUrl" placeholder="Nightbot"
						value="$(urlfetch URL) ">
				</div>

				<label class="visually-hidden" for="txbWizeBotUrl">Wizebot URL</label>
				<div class="input-group">
					<div class="input-group-text">Wizebot</div>
					<input type="text" class="form-control" id="txbWizeBotUrl" placeholder="Wizebot"
						value="  $urlcall(url,1)">
				</div>

				<label class="visually-hidden" for="txbStreamElementUrl">StreamElement URL</label>
				<div class="input-group">
					<div class="input-group-text">StreamElement</div>
					<input type="text" class="form-control" id="txbStreamElementUrl" placeholder="StreamElement"
						value="${urlfetch URL}">
				</div>

				<label class="visually-hidden" for="txbStreamLabsUrl">StreamLabs URL</label>
				<div class="input-group">
					<div class="input-group-text">StreamLabs</div>
					<input type="text" class="form-control" id="txbStreamLabsUrl" placeholder="StreamLabs"
						value="{readapi.URL}">
				</div>
			</div>

			<div>
				<button id="btnShow" type="submit" class="btn btn-primary">Aperçu</button>
				<button id="btnGenerate" type="submit" class="btn btn-primary">Générer</button>
			</div>
		</div>
	</div>
</form>